



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.2">
    
    
      
        <title>k-point sampling - YHKLAB Wiki</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#k-point-sampling" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="YHKLAB Wiki" aria-label="YHKLAB Wiki" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              YHKLAB Wiki
            </span>
            <span class="md-header-nav__topic">
              
                k-point sampling
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="YHKLAB Wiki" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    YHKLAB Wiki
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Basic Setting
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Basic Setting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../1.Basic_setting/1.1_LinuxCheatSheet/" title="Linux cheat sheet" class="md-nav__link">
      Linux cheat sheet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../1.Basic_setting/1.2_EmacsCheatSheet/" title="Emacs cheat sheet" class="md-nav__link">
      Emacs cheat sheet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../1.Basic_setting/1.3_AnacondaCheatSheet/" title="Anaconda cheat sheet" class="md-nav__link">
      Anaconda cheat sheet
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      DFT Tutorials (SIESTA)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        DFT Tutorials (SIESTA)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial_0/" title="Tutorial 0 : Basic SIESTA Calculation" class="md-nav__link">
      Tutorial 0 : Basic SIESTA Calculation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../01_GOLD_CHJ/" title="Tutorial 1 : Au Electronic Structure Calculation" class="md-nav__link">
      Tutorial 1 : Au Electronic Structure Calculation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../02_Graphene_CHJ/" title="Tutorial 2 : Graphene Electronic Structure Calculation" class="md-nav__link">
      Tutorial 2 : Graphene Electronic Structure Calculation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../03_Pseudopotential_RG/" title="Tutorial 3 : Pseudopotential generations" class="md-nav__link">
      Tutorial 3 : Pseudopotential generations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      DFT Tutorials (VASP)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        DFT Tutorials (VASP)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../ML-NEB/" title="Machine learning for nudged elastic band" class="md-nav__link">
      Machine learning for nudged elastic band
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      DFT Platform (NanoCore)
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        DFT Platform (NanoCore)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        k-point sampling
      </label>
    
    <a href="./" title="k-point sampling" class="md-nav__link md-nav__link--active">
      k-point sampling
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#k-point-sampling" class="md-nav__link">
    K-point sampling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    결과정리
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Structure optimization
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Structure optimization
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Nano02_EOS/" title="Equation of state (EOS)" class="md-nav__link">
      Equation of state (EOS) 
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Nano02_3dEOS/" title="Murnaghan fitting" class="md-nav__link">
      Murnaghan fitting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Nano03_GEO/" title="Geometry optimization" class="md-nav__link">
      Geometry optimization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#k-point-sampling" class="md-nav__link">
    K-point sampling
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    결과정리
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>k-point sampling</h1>
                
                <h3 id="k-point-sampling">K-point sampling</h3>
<p>이번장에서는 <code>NanoCore</code>를 이용해 그래핀 모델을 생성하고, <strong>k-point sampling</strong> 과정을 통해 전체 에너지가 수렴하는 k-point를 구할 것이다. </p>
<pre><code class="python">from NanoCore import *
import numpy as np

 # Modeling
atoms = carbonlab.grp(0,0)

# Number of system's atoms
num_atoms = len(atoms._atoms)

# Test for supercell
kpoint_sample = [1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25]

Energy = [] # given energy

for i in kpoint_sample:
     sim = s2.Siesta(atoms)
      sim.set_option('CGsteps', 0)
      sim.set_option('kgrid', [i, i, 1])
      sim.set_option('kshift', [0.5,0.5,0.0]) # set k shift from gamma
      sim.set_option('MixingWt', 0.10)        # adjust mixing weight (density)
      sim.set_option('BasisSize', 'SZ')       # adjust basis size
      sim.run(mpi=1, nproc=8)
      energy = s2.get_total_energy()
      Energy.append(energy)
</code></pre>

<p>'atom'는 'carbonlab 모듈에 종속된 'Atom'의 클래스 이며, 이를 통해 'grephene'을 생성한다. 이후 확인할 k-point 를 설정하고 설정한 k-point안에서 계산을 진행한다. 계산을 진행하며 각 계산에서 얻어진 에너지를 'Energy'에 저장하였다.</p>
<pre><code class="python">f = open('Ediff.txt', 'w')
for i in range(len(Energy)+1):
    if i == 0:
        f.write('k-points : %02d %02d %02d, Energy = %9.5f, Ediff=    %s' % (2*i+1, 2*i+1, 1, Energy[i], 'Not_intial_difference'))
        f.write('\n')
    elif i &lt; len(Energy):
        f.write('k-points : %02d %02d %02d, Energy = %9.5f, Ediff=%9.5f' % (2*i+1, 2*i+1, 1, Energy[i], Energy[i]-Energy[i-1]))
        f.write('\n')
    elif i == len(Energy):
        f.write('over')
        f.write('\n')
    else:
            pass
f.close()
</code></pre>

<p>'Ediff.txt'라는 파일을 만들어 저장된 에너지를 저장하였다. 이는 이후 수렴되는 에너지를 찾을 때 사용 될 것이다. Ediff파일은 아래와같다.</p>
<pre><code>k-points : 01 01 01, Energy = -321.36050, Ediff=    Not_intial_difference
k-points : 03 03 01, Energy = -322.42307, Ediff= -1.06257
k-points : 05 05 01, Energy = -322.33655, Ediff=  0.08653
k-points : 07 07 01, Energy = -322.32165, Ediff=  0.01490
k-points : 09 09 01, Energy = -322.32810, Ediff= -0.00645
k-points : 11 11 01, Energy = -322.32556, Ediff=  0.00253
k-points : 13 13 01, Energy = -322.32485, Ediff=  0.00072
k-points : 15 15 01, Energy = -322.32595, Ediff= -0.00110
k-points : 17 17 01, Energy = -322.32532, Ediff=  0.00063
k-points : 19 19 01, Energy = -322.32518, Ediff=  0.00014
k-points : 21 21 01, Energy = -322.32555, Ediff= -0.00036
k-points : 23 23 01, Energy = -322.32530, Ediff=  0.00024
k-points : 25 25 01, Energy = -322.32526, Ediff=  0.00005
over
</code></pre>

<pre><code class="python">import os, sys 

def file_len(filename):
    with open(filename) as f:
        for i, l in enumerate(f):
            pass
    return i+1 

tlines = file_len('RUN.fdf')
struct_info1 = []
struct_info2 = []

f = open('RUN.fdf', 'r')
for i in range(tlines):
    line = f.readline()
    words = line.split()
    struct_info1.append(line)
    struct_info2.append(words)
f.close()

# Get line DM.Tolerence

for i in range(len(struct_info1)):
    if len(struct_info2[i]) &gt;= 2:
        if (struct_info2[i][0]) =='DM.Tolerance':
                startnum = i
        else:
           pass
tolerance = []
tolerance =  struct_info2[startnum][1]
Tol = int(tolerance[4])
tole=1.00000
for i in range(Tol):
    tole=tole*0.1
</code></pre>

<p>수렴되는 에너지의 기준을 설정하기 위해 RUN.fdf 파일을 읽어서 Tolerance를 읽어 기준을 받아왔다. </p>
<pre><code class="python"># Checking Energy difference and find proper k-point

tline2 = file_len('Ediff.txt')

struct_info3 = []
struct_info4 = []

f = open('Ediff.txt', 'r')
for i in range(tline2):
    line = f.readline()
    words = line.split()
    struct_info3.append(line)
    struct_info4.append(words)
f.close()

#---------------------------------------------------------

for i in range(len(struct_info3)):
    if str(struct_info3[i].strip()) == 'over':
            blacknum = i+1
    else:
        pass
for j in range(1, blacknum-1):
    if abs(float(struct_info4[j][9])) &lt;= tole:
            print('kpoint= %s' % struct_info4[j][2])
            kpoint=2*j+1
    else:
            print('kpoint is not converage')

print('Converge kpoint = %d' % kpoint)
</code></pre>

<p>이제 에너지가 저장된 'Ediff.txt' 파일을 열어 에너지의 차이가 Tolerance보다 작은 k-point를 찾는다. 수렴되는 k-point는 리눅스 화면에서 확인 할 수 있다.</p>
<h3 id="_1">결과정리</h3>
<pre><code class="python">plt.plot(kpoint_sample, Energy)
plt.xlabel(&quot;Kpoint&quot;)
plt.ylabel(&quot;Energy (eV)&quot;)
plt.savefig('k-test.png', dpi=300, bbox_inches =&quot;tight&quot;)
plt.show()
</code></pre>

<p>계산된 k-point 별 에너지는 다음과 같다. 또한 이를 확인하면 수렴되는 에너지의 k-point가 적절히 구해졌는지 확인할 수 있다. 또한 수렴된 k-point는 리눅스 화면을 통해서 확인할 수 있다.</p>
<p><img alt="Screenshot" src="../img/KPOINT-02.png" /></p>
<pre><code>kpoint is not converage
kpoint is not converage
kpoint is not converage
kpoint is not converage
kpoint is not converage
kpoint is not converage
kpoint is not converage
kpoint is not converage
kpoint is not converage
kpoint is not converage
kpoint is not converage
kpoint= 25
Converge kpoint = 25
</code></pre>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../ML-NEB/" title="Machine learning for nudged elastic band" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Machine learning for nudged elastic band
              </span>
            </div>
          </a>
        
        
          <a href="../Nano02_EOS/" title="Equation of state (EOS)" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Equation of state (EOS) 
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>